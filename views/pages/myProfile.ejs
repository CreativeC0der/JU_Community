<%-include ('./header')%>
    <div class="container">
        <div class="row">
            <div class="col-md-8 mx-auto">

                <button class="btn btn-warning my-2" data-toggle="modal" data-target="#inviteModal" >
                    View Invites
                </button>

                <button type="button" class="btn btn-primary my-2 mx-2" data-toggle="modal" data-target="#groupsModal">
                    View My Groups
                </button>

                <div class="profile-card">
                    <h2 class="text-center mb-4">User Profile</h2>
                    <hr>
                    <div class="profile-picture">
                        <img src="<%= user.profileImage %>" alt="Profile Picture">
                    </div>
                    <div class="user-details">
                        <strong>Username:</strong> <%= user.userName %> <br>
                        <strong>User ID:</strong> <%= user.userId %> <br>
                        <strong>Email:</strong> <%= user.userEmail %> <br>
                        <% if (user.userRoll) { %>
                            <strong>Roll:</strong> <%= user.userRoll %> <br>
                        <% } %>
                        <% if (user.userDepartment) { %>
                            <strong>Department:</strong> <%= user.userDepartment %> <br>
                        <% } %>
                        <strong>Bio:</strong> <%= user.bio %> <br>
                        <% if (user['dynamicFields']!=null) { %>
                            <% noOfFields=Object.keys(user['dynamicFields']).length/2%>
                            <%for( let i = 1; i<=noOfFields; i++ ){%>
                                <strong><%= user['dynamicFields'][`dynamicFieldLabel${i}`] %>:</strong> 
                                <%= user['dynamicFields'][`dynamicFieldValue${i}`]%>
                                <br>
                            <% } %>
                        <% } %>
                    </div>
                    <a href="/profile/edit"><button class="btn btn-secondary edit-btn">Edit</button></a>
                </div>
            </div>
        </div>

        <!-- Invite Modal -->
        <div class="modal fade invite-modal" id="inviteModal" tabindex="-1" role="dialog" aria-labelledby="inviteModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="inviteModalLabel">Invites</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <% for(const invite of invites) { %>
                            <div class="invite-card" id="<%= invite.inviteId %>">
                                <h5>Invitation to Group [<%= invite.groupId %>] </h5>
                                <button class="btn btn-success" onclick="joinGroup('<%= invite.groupId %>','<%= invite.inviteId %>')">Accept</button>
                                <button class="btn btn-danger">Reject</button>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <!-- My Groups Modal -->
        <div class="modal fade" id="groupsModal" tabindex="-1" role="dialog" aria-labelledby="groupsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title" id="groupsModalLabel">My Groups</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <!-- Group Cards -->
                        <div class="container">
                                <% for(const group of myGroups) { %>
                                    <div class="group-card">
                                        <div class="group-details">
                                            <strong>Group ID:</strong> <%= group.groupId %> <br>
                                            <strong>Group Name:</strong> <%= group.groupName %><br>
                                            <strong>Admin:</strong> <%= group.adminId %>
                                            <a href="/group/dashboard?groupId=<%= group.groupId %>">
                                                <button class="btn btn-primary" style="float: right;">View Dashboard</button>
                                            </a>
                                        </div>
                                    </div>
                                <% } %>
    
                                <!-- Add more group cards here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-close-modal" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    

    </div>
<%-include ('./footer')%>

<script>
    async function joinGroup(groupId,inviteId) {

            const response=await fetch('/members/create',{
                method:'POST',
                headers:{
                    'Content-Type':'application/json'
                },
                body:JSON.stringify({groupId,inviteId})
            })
            const data=await response.json();
            console.log(data);
            $('#'+inviteId).remove();

    }
</script>
